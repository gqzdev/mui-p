<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			#scanContainer{
				position:absolute;
				top: 50%;
				left: 10%;
				border: 1px solid sandybrown;
				width: 300px;
				height: 300px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">条码扫描  barcode</h1>
		</header>
		
		<div class="mui-content">
		    <p style="text-indent: 2em;">Barcode模块管理条码扫描，支持常见的条码（一维码及二维码）的扫描识别功能。
		    	可调用设备的摄像头对条码图片扫描进行数据输入，解码后返回码数据及码类型。
		    	通过plus.barcode可获取条码码管理对象。
		    </p>
		    
		    <button type="button" class="mui-btn mui-btn-blue mui-btn-block" onclick="scan1()">扫描本地的条码</button>
		    <button type="button" class="mui-btn mui-btn-blue mui-btn-block" onclick="scan2()">打开摄像头扫描的条码</button>
		    
		    <div id="scanContainer"></div>
		    <button type="button" class="mui-btn mui-btn-blue mui-btn-block" onclick="scan2()">打开闪光灯</button>
		    
		</div>
		
		<script src="js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init();
			
			//扫描本地的条码
			function scan1 () {
				plus.gallery.pick(function(path){
						console.log("获取成功！"+path);
						//扫面获取的图片上的条码
						plus.barcode.scan(path,
							function(type,code,file1){
								console.log("扫描成功!"+type+" ,"+code+" ,"+file1);
								//扫描成功震动
								plus.device.vibrate(300);
								//打开code
								mui.openWindow({
									id:code,
									url:code
								});
							},function(error){
								console.log("扫描失败！"+error.message);
							}
						);
						
					},function(e){
						console.log("获取失败！"+e.message);
					}
				);
			}
			
			//打开摄像头扫描的条码
			function scan2 () {
				//创建BarCode对象
				var barcode=new plus.barcode.Barcode("scanContainer");
				/*
			    start: 开始条码识别
			    cancel: 结束条码识别
			    close: 关闭条码识别控件
			    setFlash: 是否开启闪光灯
				*/
				//
				barcode.onmarked=function(type,code,file){
					console.log("扫描成功!"+type+" ,"+code+" ,"+file);
					//扫描成功震动
					plus.device.vibrate(300);
					//打开code
					mui.openWindow({
						id:code,
						url:code
					});
				}
				
				barcode.onerror=function(error){
					console.log("扫描失败！"+error.message);
				}
				
				//开始扫描
				barcode.start();
			}
		</script>
	</body>

</html>